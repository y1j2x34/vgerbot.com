# 灰度算法

### 平均法

#### 公式：
```js
Gray = (R + G + B) / 3
```
#### 优点：
公式简单
#### 缺点：
从人眼感知角度看，图片的灰度阴影和亮度方面的效果较差

### 基于人眼感知

#### 公式1：
```js
Gray = (R * 0.3 + G * 0.59 + B * 0.11)
```
#### 公式2：
```js
Gray = (R * 0.2126 + G * 0.7152 + B * 0.0722)
```
#### 公式3：
```js
Gray = (R * 0.299 + G * 0.587 + B * 0.114)
```
==
最佳公式还存在争议。。。

#### 算法优化（对公式3）

```js
0.299 * 65536 = 19595.264 ≈ 19595
0.587 * 65536 + (0.264) = 38469.632 + 0.264 = 38469.896 ≈ 38469
0.114 * 65536 + (0.896) =   7471.104 + 0.896 = 7472
Gray =  (R*19595 + G*38469 + B*7472) >> 16
```
2至20位精度的系数：

```js
Gray = (R*1 + G*2 + B*1) >> 2
Gray = (R*2 + G*5 + B*1) >> 3
Gray = (R*4 + G*10 + B*2) >> 4
Gray = (R*9 + G*19 + B*4) >> 5
Gray = (R*19 + G*37 + B*8) >> 6
Gray = (R*38 + G*75 + B*15) >> 7
Gray = (R*76 + G*150 + B*30) >> 8
Gray = (R*153 + G*300 + B*59) >> 9
Gray = (R*306 + G*601 + B*117) >> 10
Gray = (R*612 + G*1202 + B*234) >> 11
Gray = (R*1224 + G*2405 + B*467) >> 12
Gray = (R*2449 + G*4809 + B*934) >> 13
Gray = (R*4898 + G*9618 + B*1868) >> 14
Gray = (R*9797 + G*19235 + B*3736) >> 15
Gray = (R*19595 + G*38469 + B*7472) >> 16
Gray = (R*39190 + G*76939 + B*14943) >> 17
Gray = (R*78381 + G*153878 + B*29885) >> 18
Gray = (R*156762 + G*307757 + B*59769) >> 19
Gray = (R*313524 + G*615514 + B*119538) >> 20
```

### 去饱和
就是把RGB转换为HSL，饱和度设为0。

#### 公式：
```js
Gray = (Math.max(R, G, B) + Math.min(R, G, B)) / 2
```
去饱和后，图片立体感减弱，但更柔和。

### 分解

取最大值或者最小值。

#### 最大值分解

```js
Gray = Math.max(R, G, B)
```

#### 最小值分解

```js
Gray = Math.min(R, G, B)
```

最大值分解生成更明亮的图，最小值分解生成更黑暗的图

### 单一通道

```js
Gray = R
// or
Gray = G
// or
Gray = B
```
大多数数码相机用这种算法生成灰度图

### 自定义灰度阴影

由用户提供灰色阴影值(numberOfShades)，范围为[2, 256], 2的结果是一张全白的值，256的结果和平均值法的效果一样

#### 公式
```js
ConversionFactor = 255 / (numberOfShades - 1)
AverageValue = (R + G + B) / 3
Gray = Math.round(AverageValue / ConversionFactor + 0.5) + ConversionFactor
```

















